<ion-hide-when size="lg">
  <ion-header>
    <app-header [showHalalTag]="true" [showLanguage]="true"></app-header>
  </ion-header>
</ion-hide-when>
<ion-content>
  <div class="banner-home container">
    <banner-widget
      [componentId]="getComponentId()"
      pfWidgetImpressionTrack
      [type]="'tag'"
      [executor]="bannerWidgetExecutor"
      [action]="bannerWidgetAction"
    >
      <ng-template let-widget="widget">
        <div *ngIf="widget.model == undefined">
          <app-skeleton [aspectRatio]="2" [width]="'100%'"></app-skeleton>
        </div>
        <div *ngIf="widget.model != undefined && widget.model.length > 0">
          <div>
            <img src="{{getFullBannerUrl(widget.model[0].contentUrl)}}"
                 img-preloader="{{getFullBannerUrl(widget.model[0].contentUrl)}}"
                 defaultImage="assets/imgs/default/no-preview.jpeg"/>
          </div>
        </div>
      </ng-template>
    </banner-widget>
  </div>

  <div class="delivery-wrap" *ngIf="!isStoreSelected()">
    <div class="delivery-take-away">
      <fulfilment-mode-widget [componentId]="getComponentId()" pfWidgetImpressionTrack
                              [action]="fulfilmentModeWidgetAction">
        <ng-template let-widget="widget">
          <div *ngIf="widget.model == undefined">
            <ion-segment style="visibility: hidden">
              <ion-segment-button>
                <small class="delivery-icon segment-checked"></small>
                <span>{{'home_page.delivery' | translate}}</span>
              </ion-segment-button>
              <ion-segment-button>
                <small class="takeaway-icon"></small>
                <span>{{'home_page.take_away' | translate}}</span>
              </ion-segment-button>
            </ion-segment>
          </div>
          <div *ngIf="widget.model != undefined">
            <ion-segment>
              <ion-segment-button text-capitalize value="{{deliveryModes?.HOME_DELIVERY}}"
                                  [class.segment-checked]="widget.model.mode === deliveryModes?.HOME_DELIVERY"
                                  (click)="changeOrderMode(deliveryModes.HOME_DELIVERY)">
                <small class="delivery-icon"></small>
                <span>{{'home_page.delivery' | translate}}</span>
              </ion-segment-button>
              <ion-segment-button text-capitalize value="{{deliveryModes?.PICKUP}}"
                                  [class.segment-checked]="widget.model.mode === deliveryModes?.PICKUP"
                                  (click)="changeOrderMode(deliveryModes.PICKUP)">
                <small class="takeaway-icon"></small>
                <span>{{'home_page.take_away' | translate}}</span>
              </ion-segment-button>
            </ion-segment>
          </div>
        </ng-template>
      </fulfilment-mode-widget>

      <location-widget
        [componentId]="getComponentId()"
        [mode]="'geography'"
        [locator]="'city'"
        [deliveryMode]="globalSharedService.getFulfilmentMode()?.mode"
        [action]="locationsWidgetAction">
        <ng-template let-widget="widget">
          <div *ngIf="widget.model == undefined">
            <div class="location-bar">
              <div class="form-control">
                <ion-searchbar class="form-search" #focusInput
                               showCancelButton="false"
                               placeholder="{{'home_page.select_area' | translate}}">
                </ion-searchbar>
              </div>
              <div class="form-control">
                <ion-searchbar class="form-search" [debounce]="1000" #focusInput
                               showCancelButton="false"
                               placeholder="{{'home_page.select_block' | translate}}">
                </ion-searchbar>
              </div>
            </div>
          </div>
          <div *ngIf="widget.model != undefined">
            <div class="location-bar">
              <div class="form-control">
                <ion-searchbar class="form-search" [debounce]="1000" [(ngModel)]="selectedCity" #focusInput
                               showCancelButton="false" placeholder="{{'home_page.select_area' | translate}}"
                               (click)="toggleDropDown('city');"
                               (ionInput)="toggleDropDown('city', true, true);filterEntity($event, 'city')">
                </ion-searchbar>
                <ion-list *ngIf="isDropDownShown('city')" text-center class="location-block-list">
                  <ion-spinner color="success" name="bubbles">
                  </ion-spinner>
                </ion-list>
                <ion-list *ngIf="isDropDownShown('city')" class="location-block-list citydrp">
                  <ion-item (click)="selectCity(city)" no-padding
                            *ngFor="let city of filterEmptyCities(widget.model.cities)">
                    <span>{{ city.name }}</span>
                  </ion-item>
                </ion-list>
              </div>
              <div class="form-control"
                   *ngIf="getDeliveryMode() === deliveryModes?.HOME_DELIVERY">
                <ion-searchbar class="form-search" [debounce]="1000" [(ngModel)]="selectedArea" #focusInput
                               showCancelButton="false" placeholder="{{'home_page.select_block' | translate}}"
                               (click)="toggleDropDown('area');"
                               (ionInput)="toggleDropDown('area', true, true);filterEntity($event, 'city')">
                </ion-searchbar>
                <ion-list *ngIf="isDropDownShown('area')" text-center class="location-block-list">
                  <ion-spinner color="success" name="bubbles">
                  </ion-spinner>
                </ion-list>
                <ion-list *ngIf="isDropDownShown('area')" class="location-block-list citydrp">
                  <ion-item (click)="selectArea(area)" no-padding *ngFor="let area of widget.model.areas">
                    <span>{{ getAreaDisplayName(area) }}</span>
                  </ion-item>
                </ion-list>
              </div>
            </div>
          </div>
        </ng-template>
      </location-widget>
      <store-locator-widget [componentId]="getComponentId()" [action]="storeLocatorWidgetAction">
        <ng-template let-widget="widget">
          <div *ngIf="widget.model != undefined">
            <div
              *ngIf="globalSharedService.getFulfilmentMode() && globalSharedService.getFulfilmentMode().mode === deliveryModes.PICKUP && selectedStore && !selectedStore.isDefaultLocation"
              class="take-away-block">
              <span>{{'home_page.your_pickup_hut_is' | translate}} </span>
              <div class="store-name">{{selectedStore?.name}}</div>
              <p>{{selectedStore?.address}}</p>

            </div>
            <div style="padding: 0 10px; margin-bottom: 10px;">
              <ion-button (click)="findStore()" color="success" mode="ios" class="btn-success" text-capitalize expand="block">
                {{'home_page.start_my_order' | translate}}
              </ion-button>
            </div>

          </div>
        </ng-template>
      </store-locator-widget>

      <location-widget
        [componentId]="getComponentId()"
        [mode]="'geometry'"
        [deliveryMode]="globalSharedService.getFulfilmentMode()?.mode"
        [action]="locationsWidgetActionGeometry"
        [instanceId]="1">
        <ng-template let-widget="widget">
          <div class="find-hut" (click)="locateMe(widget.model.geometry.latitude, widget.model.geometry.longitude)">
            <span> {{'home_page.find_my_nearest_hut' | translate}}</span>
          </div>
        </ng-template>
      </location-widget>

    </div>
  </div>
  <div class="delivery-wrap" *ngIf="isStoreSelected()">
    <ion-card>
      <ion-card-content class="mode-selection bx-shadow-4 card-content
                card-content-md box-shadow-card collection-details">

        <div
          *ngIf="globalSharedService.getFulfilmentMode() && globalSharedService.getFulfilmentMode().mode === deliveryModes?.PICKUP">
          {{'home_page.collection'|translate}}
        </div>
        <div
          *ngIf="globalSharedService.getFulfilmentMode() && globalSharedService.getFulfilmentMode().mode === deliveryModes?.HOME_DELIVERY">
          {{'home_page.delivery_name'|translate}}
        </div>
        <div class="store-name">{{selectedStore?.name}}</div>
        <p>{{selectedStore?.address}}</p>
        <ion-button color="medium" class="btn-signin" expand="block" mode="ios" (click)="changeSelectedStore()"
                    class="btn-signin">
          {{'home_page.change'|translate}}
        </ion-button>
        <ion-button expand="block" mode="ios" color="success" (click)="navigateToDeals()" class="button">
          {{'home_page.see_deals_menu' | translate}}
        </ion-button>

      </ion-card-content>
    </ion-card>
  </div>
  <div class="container">
    <app-banner></app-banner>
    <ion-row margin-bottom justify-content-center padding>
      <ion-col size-xs='12'>
        <ion-button color="success" (click)="navigateToDeals()" text-capitalize expand="block" mode="ios">
          {{'home.page.view_all_deals' | translate}}
        </ion-button>
      </ion-col>
    </ion-row>
  </div>
  <app-footer></app-footer>
</ion-content>
